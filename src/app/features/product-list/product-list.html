<h1>
  @if (isEditMode) {
    Editar Pedido: <span>{{ storeName }}</span>
    <span class="order-date">
      ({{ orderDate | date:'MMMM yyyy' }})
    </span>
  } @else {
    Realizar Pedido: <span>{{ storeName }}</span>
  }
</h1>
<mat-toolbar color="primary" class="topbar">
  <span class="toolbar-title">
    
  </span>
  <span class="spacer"></span>
</mat-toolbar>

<div class="page">
  @if (loading) {
  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  <p class="loading">Loading products...</p>
  } @else {
  <mat-card class="table-card mat-elevation-z4">
    <table mat-table [dataSource]="products">

      <!-- Name -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Nombre</th>
        <td mat-cell *matCellDef="let p">{{ p.name }}</td>
      </ng-container>

      <!-- SKU -->
      <ng-container matColumnDef="sku">
        <th mat-header-cell *matHeaderCellDef>SKU</th>
        <td mat-cell *matCellDef="let p" class="descr">{{ p.sku }}</td>
      </ng-container>

      <!-- Price -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Precio</th>
        <td mat-cell *matCellDef="let p" class="descr">{{ p.price | currency }}</td>
      </ng-container>

      <!-- Quantity -->
      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef class="qty-head">Cantidad</th>
        <td mat-cell *matCellDef="let p" class="qty-cell">
          <button mat-icon-button (click)="updateQuantity(p, false)" [disabled]="p.quantity === 0"
            aria-label="Decrease">
            <mat-icon>remove</mat-icon>
          </button>
          <input class="qty-input" type="number" [value]="p.quantity" readonly>
          <button mat-icon-button (click)="updateQuantity(p, true)" aria-label="Increase">
            <mat-icon>add</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      <!-- Footer: single cell spanning all columns -->

      <ng-container matColumnDef="totalFooter">
  <td mat-footer-cell *matFooterCellDef [attr.colspan]="displayedColumns.length" class="total-footer">
    <div class="total-footer-content">
      <strong>Artículos:</strong> {{ totalItems }}
      &nbsp;&nbsp;&nbsp;&nbsp;
      <strong>Total:</strong> {{ grandTotal | currency }}
    </div>
  </td>
</ng-container>

<tr mat-footer-row *matFooterRowDef="footerColumns"></tr>
 <!-- Aviso de límite -->
<div class="limit-warning" *ngIf="exceedsLimit">
  Has excedido el el limite establecido de ${{ maxQuantity }}.
  Elimina artículos para continuar.
</div>
    </table>
  </mat-card>

<div class="submit-wrap">
  <button mat-raised-button color="primary"
          (click)="submitOrder()"
          [class]="{'loading': loading, 'disabled': loading || totalItems === 0 || exceedsLimit}"
          [disabled]="loading || totalItems === 0 || exceedsLimit">
    Ordenar
  </button>
</div>
  }
</div>