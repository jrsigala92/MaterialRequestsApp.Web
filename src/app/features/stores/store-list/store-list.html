<h1 class="page-title">Lista de Tiendas</h1>

<div class="page-actions">
  <mat-form-field appearance="outline" class="grow">
    <mat-label>Filtro</mat-label>
    <input matInput [formControl]="filterCtl" placeholder="Buscar por código o nombre..." />
  </mat-form-field>

  <button mat-raised-button color="primary" class="btn" (click)="onAdd()">
    Nueva Tienda
  </button>
</div>

<mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

<!-- Mobile: cards -->
<ng-container *ngIf="isHandset$ | async; else desktopTable">
  <div class="card-list">
    <mat-card class="store-card" *ngFor="let row of dataSource.data">
      <mat-card-title class="card-title">
        {{ row.name }}
        <span class="muted">({{ row.code }})</span>
      </mat-card-title>

      <mat-card-content class="card-grid">
        <div class="kv"><span class="k">Responsable</span><span class="v">{{ row.responsible }}</span></div>
        <div class="kv"><span class="k">Ciudad</span><span class="v">{{ row.city }}</span></div>
        <div class="kv"><span class="k">Presupuesto</span><span class="v">{{ row.maxQuantity | currency }}</span></div>
      </mat-card-content>

      <mat-card-actions align="end">
        <button mat-stroked-button (click)="onEdit(row)">
          <mat-icon>edit</mat-icon>&nbsp;Editar
        </button>
        <button mat-stroked-button color="warn" (click)="onDelete(row)">
          <mat-icon>delete</mat-icon>&nbsp;Eliminar
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <mat-paginator
    [length]="total"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5,10,25,100]"
    showFirstLastButtons
    (page)="onPageChange()">
  </mat-paginator>
</ng-container>

<!-- Desktop/Tablet: table -->
<ng-template #desktopTable>
  <div class="table-container" role="region" aria-label="Lista de Tiendas">
    <table mat-table [dataSource]="dataSource" matSort class="responsive-table">

      <!-- Code -->
      <ng-container matColumnDef="code">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Código</th>
        <td mat-cell *matCellDef="let row">{{ row.code }}</td>
      </ng-container>

      <!-- Name -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
        <td mat-cell *matCellDef="let row">{{ row.name }}</td>
      </ng-container>

      <!-- Responsible -->
      <ng-container matColumnDef="responsible">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Responsable</th>
        <td mat-cell *matCellDef="let row">{{ row.responsible }}</td>
      </ng-container>

      <!-- City -->
      <ng-container matColumnDef="city">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Ciudad</th>
        <td mat-cell *matCellDef="let row">{{ row.city }}</td>
      </ng-container>

      <!-- MaxQuantity -->
      <ng-container matColumnDef="maxQuantity">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Presupuesto</th>
        <td mat-cell *matCellDef="let row">{{ row.maxQuantity | currency }}</td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="actions-header">Acciones</th>
        <td mat-cell *matCellDef="let row" class="actions-cell">
          <button mat-icon-button aria-label="Editar" (click)="onEdit(row)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" aria-label="Eliminar" (click)="onDelete(row)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="5">Sin resultados</td>
      </tr>
    </table>
  </div>

  <mat-paginator
    [length]="total"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5,10,25,100]"
    showFirstLastButtons
    (page)="onPageChange()">
  </mat-paginator>
</ng-template>
